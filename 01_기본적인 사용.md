# 01. console 객체와 process 객체

## - console

 - dir() : 객체 속성 확인
 - time('id')
 - timeEnd('id')

## - process

 - argv : 프로세스 실행할 때 전달되는 파라미터
 - env : 환경 변수
 - exit()

### * OS 환경 변수의 값
```js
process.env['OS']
```
### * 주요 전역 변수

 - `__filename` : 실행한 파일 이름(Path 전체)
 - `__dirname` : 실행한 파일이 들어있는 폴더(Path 전체)

<br><br><br><br><br>
<hr>
<br><br><br><br><br>



# 02. 모듈 관리

## - 모듈화와 사용 1

### * export
```js
exports.함수이름 = 구현부
```
 - `module.js`
```js
exports.test = function(){
    console.log("모듈 불러옴");
}

exports.test2 = function(){
    console.log("모듈 불러옴2");
}
```

### * import
```js
var module = require('module.js');
module.함수이름();
```
 - `main.js`

```js
let sample = require('./module');
sample.test(); /*모듈 불러옴*/
sample.test2(); /*모듈 불러옴2*/
```

## - 모듈화와 사용 2

### * export
```js
var something = {}

something.프로퍼티 = 구현

module.exports = something;
```

### * Example

 - module.js
```js
let calc = {}

calc.add = (n1, n2) => {
    return n1 + n2;
}

calc.mul = (n1, n2) => {
    return n1 * n2;
}

module.exports = calc;
```


 - main.js
```js
let calc = require('./module');

console.log(calc.add(10, 20)); //30
console.log(calc.mul(10, 20)); //200
```

<br><br><br><br><br>
<hr>
<br><br><br><br><br>

# 03. 시스템 환경 변수에 접근하기 `nconf`

```cmd
npm install nconf
```

```js
let nconf = require('nconf');
nconf.env();

console.log(`OS 환경변수의 값 : ${nconf.get('OS')}`);
```

<br><br><br><br><br>
<hr>
<br><br><br><br><br>

# 04. npm 사용

## * package.json 만들기

```cmd
npm init
```

## * npm 설치/지우기

```cmd
npm uninstall nconf
```

```cmd
npm install nconf --save
```

 - package.json에 정의된 모듈 설치
```cmd
npm install
```


<br><br><br><br><br>
<hr>
<br><br><br><br><br>

# 05. 빌트인

## - `os` 모듈

| 메소드 이름 | 설명 |
|:---:|:---:|
|hostname()| 운영체제의 호스트 이름|
|totalmem()| 시스템의 전체 메모리 용량|
|freemem()| 사용가능한 메모리 용량|
|cpus()|CPU정보|
|networkInterfaces()| 네트워크 인터페이스 정보를 담은 배열|

## - `path` 모듈

| 메소드 이름 | 설명 |
|:---:|:---:|
|join()| 파일 패스 합치기|
|dirname()| 디렉터리 이름 반환|
|basename()| 확장자를 제외한 이름 |
|extname()| 확장자 반환|

### * Example

```js
let path = require('path');

console.log(path.sep); // "\"

let filepath = `WORKSPACE/CodeWorld/GIT-REPO-ARCHIVE/JS/Playground.NodeJS/main.js`

console.log(`dirname : ${path.dirname(filepath)}`);
console.log(`basename : ${path.basename(filepath)}`);
console.log(`extname : ${path.extname(filepath)}`);

/* 
dirname : WORKSPACE/CodeWorld/GIT-REPO-ARCHIVE/JS/Playground.NodeJS
basename : main.js
extname : .js
*/
```


<br><br><br><br><br>
<hr>
<br><br><br><br><br>

# 06. 노드 기본 기능

## - 주소 다루기

### * url 모듈 & querystring 모듈

#### url 모듈

 - `parse()` : 주소 문자열 -> URL 객체
 - `format()` : URL 객체 -> 주소 문자열

#### querystring 모듈

 - `parse()` : 문자열 -> Parameter 객체
 - `stringify()` : Parameter -> 문자열

```js
let url = require('url');
let queryString = require('querystring');

let strUrl = 'https://search.naver.com/search.naver?where=nexearch&sm=top_hty&fbm=1&ie=utf8&query=node.js';

let urlObj = url.parse(strUrl); //deprecated
console.log(strUrl); //https://search.naver.com/search.naver?where=nexearch&sm=top_hty&fbm=1&ie=utf8&query=node.js 
let param = queryString.parse(urlObj.query); //Parameter 객체
console.log(param);
/* 
{
  where: 'nexearch',
  sm: 'top_hty',
  fbm: '1',
  ie: 'utf8',
  query: 'node.js'
}
*/
```



## - 이벤트 처리
 
### * process.
 - `on(event, listener)`
 - `once(event, listener)` : 한번 실행후 자동으로 제거됨
 - `removeListener(event, listener)`
 - `emit(eventName, parameter)` : 사용자 정의 이벤트

```js
process.on('exit', function(){
    console.log('exit 이벤트 발생');
})

process.exit();
```

### * 이벤트 모듈화

process 객체를 이용하여 이벤트를 다루면 이름이 충돌될 수도 있다.
 
 - `module.js`

```js
let util = require('util'); //상속 기능 사용을 위해
let EventEmitter = require('events').EventEmitter //이벤트 리스터 함수들은 이걸 상속받음

let EventObj = function(){

    let that = this;

    that.on("myEvent", function(a, b){
        console.log(`myEvent 발생 : ${a}, ${b}`);
    });
    
};

util.inherits(EventObj, EventEmitter);

module.exports = EventObj;
module.exports.title = "이벤트 테스트";
```

 - `main.js`

```js
let EventObj = require('./module');

console.log(EventObj.title); //이벤트 테스트
new EventObj().emit('myEvent',10,20); //myEvent 발생 : 10, 20
```

## - 파일 다루기

### * fs 모듈

 - `readFile(filename, [encoding], [callback])`
 - `readFileSync(filename, [encoding])`
 - `writeFile(filename, data, encoding='utf8', [callback])`
 - `writeFileSync(filename, data, encoding='utf8')`


#### 파일 쓰기
```js
let fs = require('fs');
let path = require('path');

let fileName = "myFile.txt"

fs.writeFile(
    path.join(__dirname,fileName),
    "This is my file~",
    function(err){
        if(err){
            console.log("Error : " + err);
        }

        console.log(`${fileName} 쓰기 완료`);
    }
);
```

#### 파일 읽기

```js
let fs = require('fs');
let path = require('path');

let fileName = "myFile.txt"

fs.readFile(
    path.join(__dirname,fileName),
    function(err, data){
        if(err){
            console.log("Error : " + err);
        }

        console.log(data.toString()); //This is my file~
        console.log(`${fileName} 읽기 완료`);
    }
);
```

### * 스트림

```js
let fs = require('fs');
let path = require('path');

let infilePath = path.join(__dirname,"myFile.txt");
let outfilePath = path.join(__dirname,"myFile2.txt");

let infile = fs.createReadStream(infilePath, {flags:'r'});
let outfile = fs.createWriteStream(outfilePath, {flags:'w'});

infile.on('data',function(data){
    console.log(`읽은 데이터 ${data}`);
    outfile.write(data);
})

infile.on('end',function(){
    console.log("파일 읽기 종료");
    outfile.end(()=>console.log("파일 쓰기 종료"));
})

/* 
읽은 데이터 This is my file~
파일 읽기 종료
파일 쓰기 종료
*/
```

<br><br><br><br><br>
<hr>
<br><br><br><br><br>

# 07. 웹 서버 기본

## - 기본 틀

```js
let http = require('http');

let server = http.createServer();

let port = 3000;

server.listen(port, function(){
    console.log("서버 시작");
})

server.on('connection', function(socket){
    console.log(socket);
})

server.on('request', function(req,res){
    console.log(req);

    res.writeHead(200, {"Content-Type":"text/html;charset=utf-8"});
    res.write('<!DOCTYPE html>');
    res.write('<html>');
    res.write('<body>');
    res.write('<h1>Hello World</h1>');
    res.write('<body>');
    res.write('</body>');
    res.write('</html>');
    res.end();
})
```

## - Expess.js 적용

### * request --> middleware --> router --> response

```cmd
npm install --save express
```
```cmd
npm show express version
```
 - `app.js`
```js
const express = require('express')
const app = express()
const port = 3000

app.get('/', (req, res) => {
  res.send('Hello World!')
})

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```
### * 메서드와 속성

#### 메서드
 - set() : 서버 설정 setter
 - get() : 서버 설정 getter
 - use() : 미들웨어

#### 속성
 - env : 서버 모드를 설정
 - views : 뷰들이 들어 있는 폴더 또는 폴더 배열 설정
 - view engine : 디폴트로 사용할 뷰 엔진 설정

### * Routing 메서드

```js
const express = require('express')
const app = express()
const port = 3000

app.get('/', function (req, res) {
  res.send('Hello World!');
});


app.post('/', function (req, res) {
  res.send('Got a POST request');
});


app.put('/user', function (req, res) {
  res.send('Got a PUT request at /user');
});


app.delete('/user', function (req, res) {
  res.send('Got a DELETE request at /user');
});

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

#### URL 파라미터

```js
const express = require('express');
const app = express();
const port = 3000;

app.get('/users/:userId/books/:bookId', function (req, res) {
    res.send(req.params)
})

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

접속 : `http://localhost:3000/users/rhie/books/nodejs`

접속 결과
```json
{"userId":"rhie","bookId":"nodejs"}
```

#### Routing 핸들러 콜백 함수 활용

```js
const express = require('express')
const app = express()
const port = 3000

app.get('/cbchain', function(req,res,next){
  console.log('CB0');
  next();
}, function(req,res,next){
  console.log('CB1');
  next();
},function(req,res){
  res.send('Hello from C!');
});

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

#### Routing 핸들러 콜백 함수 배열 적용

```js
const express = require('express')
const app = express()
const port = 3000

var cb0 = function (req, res, next) {
  console.log('CB0');
  next();
}

var cb1 = function (req, res, next) {
  console.log('CB1');
  next();
}

var cb2 = function (req, res) {
  res.send('Hello from C!');
}

app.get('/cbchain', [cb0, cb1, cb2]);


app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```
### * Response 메서드

|Method|Description|
|:---:|:---:|
|res.download()|	Prompt a file to be downloaded.|
|res.end()|	End the response process.|
|res.json()|	Send a JSON response.|
|res.jsonp()|	Send a JSON response with JSONP support.|
|res.redirect()|	Redirect a request.|
|res.render()|	Render a view template.|
|res.send()|	Send a response of various types.|
|res.sendFile()|	Send a file as an octet stream.|
|res.sendStatus()|	Set the response status code and send its string representation as the response body.|


## - Expess.js 미들웨어

### * 미들웨어 기본 사용법

```js
const express = require('express')
const app = express()
const port = 3000

app.use((req, res, next)=>{
    console.log("첫번째 미들웨어");
    req.name = "RHIE";
    next();
})

app.use((req, res, next)=>{
    console.log("두번째 미들웨어");
    next();
})

app.get('/', (req, res) => {
    res.send(`Hello World! ${req.name}`)
})
  
app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```



### * 웹문서

 - `public/index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
    <title>Document</title>
</head>
<body>
    <h1>Hello World</h1>
    <script src="/static/js/script.js"></script>
</body>
</html>
```
 - `public/css/style.css`
```css
h1{
  color : red;  
}
```
 - `public/js/script.js`

```js
console.log("자바스크립트 로딩 완료");
```

 - `main.js` || `app.js`
 
접속 : `localhost:3000/static/index.html`

```js
const express = require('express')
const path = require('path');
const app = express();
const port = 3000;

app.use('/static', express.static(path.join(__dirname, 'public')))


app.get('/', (req, res) => {
    res.send(`Hello World!`)
})

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```
### * Router 객체 사용하기

 - `bird.js`

```js
var express = require('express')
var router = express.Router()

// middleware that is specific to this router
router.use(function timeLog (req, res, next) {
  console.log('Time: ', Date.now())
  next()
})
// define the home page route
router.get('/', function (req, res) {
  res.send('Birds home page')
})
// define the about route
router.get('/about', function (req, res) {
  res.send('About birds')
})

module.exports = router
```

 - `app.js`

접속 : `http://localhost:3000/bird`<br>
접속 : `http://localhost:3000/bird/about`

```js
const express = require('express');
const bird = require('./bird');
const app = express();
const port = 3000;

app.use('/bird', bird)

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

## - Expess.js 미들웨어 활용

### * 에러 처리

```js
const express = require('express');
const app = express();
const port = 3000;

app.get('/', (req, res) => {
    res.send(`Hello World!`)
})

app.all('*', (req,res)=>{
  res.status(404).send("<h1>페이지 없음</h1>");
})

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

### * 쿠키 처리 (클라이언트)

```js
const express = require('express');
const app = express();
const cookieParser = require('cookie-parser');
const port = 3000;

app.use(cookieParser());

app.get('/setCookie', (req, res) => {
  res.cookie('member', {
    id : 'quoti',
    name : 'rhie',
    authorized : true
  })

  res.send("<h3>쿠키 설정 완료</h3>")
})

app.get('/getCookie', (req, res) => {
  res.send(req.cookies);
})

app.all('*', (req,res)=>{
  res.status(404).send("<h1>페이지 없음</h1>");
})

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

### * 세션 처리 (서버)

세션을 사용할 때는 쿠키도 같이 사용함으로 `cookie-parser`필요

`connect.sid`


쿠키 내의 클라이언트에 세션 식별자 만 저장하고 일반적으로 데이터베이스의 서버에 세션 데이터를 저장

```js
const express = require('express');
const app = express();
const cookieParser = require('cookie-parser');
const expressSession = require('express-session');
const port = 3000;

app.use(cookieParser());
app.use(expressSession({
  secret:"my secret key",
  resave: true,
  saveUninitialized: true
}))

app.get('/setCookie', (req, res) => {
  res.cookie('member', {
    id : 'quoti',
    name : 'rhie',
    authorized : true
  })

  res.send("<h3>쿠키 설정 완료</h3>")
})

app.get('/getCookie', (req, res) => {
  res.send(req.cookies);
})

app.get('/login', (req, res) => {
  
  console.log("::: /login 접근 :::");

  if(req.session.user){
    console.log(req.cookies)
    console.log(req.session.user);
    res.send("<h3>이미 로그인됨</h3>");
  }else{
    req.session.user = {
      id : 'rob',
      name : 'brian',
      authorized: true
    }
    console.log(req.cookies);
    console.log(req.session.user);
    res.send(req.session.user);
  }


})

app.get('/check', (req, res) => {

  console.log("::: /check 접근 :::");

  if(req.session.user){
    console.log(req.cookies)
    console.log(req.session.user);
    res.send("<h3>권한 있음</h3>");
  }else{
    console.log(req.cookies)
    console.log(req.session.user);
    res.send("<h3>권한 없음</h3>");
  }
  
})

app.all('*', (req,res)=>{
  res.status(404).send("<h1>페이지 없음</h1>");
})

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})
```

### * Multipart 처리

#### # multer

 - `index.html`

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/css/style.css">
  <title>Document</title>
</head>

<body>
  <h1>Hello World</h1>

  <form action="/stats" enctype="multipart/form-data" method="post">
    <div class="form-group">
      <input type="file" class="form-control-file" name="uploaded_file">
      <input type="text" class="form-control" placeholder="Number of speakers" name="nspeakers">
      <input type="submit" value="Get me the stats!" class="btn btn-default">
    </div>
  </form>
  <script src="/static/js/script.js"></script>
</body>

</html>
```

 - `app.js`

```js

```